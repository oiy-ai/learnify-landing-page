# å¼€å‘ä»»åŠ¡æ¸…å• - ç®¡ç†å‘˜ç³»ç»Ÿæ‰©å±•

## é¡¹ç›®ç›®æ ‡
åŸºäºç°æœ‰è®¢é˜…åˆ¶å…¬å¸é¦–é¡µï¼Œæ·»åŠ å®Œæ•´çš„åç«¯ç®¡ç†ç³»ç»Ÿï¼Œå®ç°ç”¨æˆ·ç®¡ç†ã€è®¢é˜…ç®¡ç†å’Œäº§å“é…ç½®åŠŸèƒ½ã€‚

## é˜¶æ®µä¸€ï¼šæ•°æ®æ¨¡å‹æ‰©å±•å’Œæƒé™ç³»ç»Ÿ ğŸ—ï¸

### 1.1 æ‰©å±•æ•°æ®åº“æ¨¡å¼
**æ–‡ä»¶ä¿®æ”¹**: `convex/schema.ts`
- [ ] æ·»åŠ ç®¡ç†å‘˜è§’è‰²å­—æ®µåˆ°usersè¡¨
- [ ] åˆ›å»ºadminsè¡¨å­˜å‚¨ç®¡ç†å‘˜æƒé™
- [ ] åˆ›å»ºproductsè¡¨å­˜å‚¨äº§å“é…ç½®
- [ ] åˆ›å»ºaudit_logsè¡¨è®°å½•ç®¡ç†æ“ä½œ
- [ ] æ·»åŠ user_sessionsè¡¨è·Ÿè¸ªç”¨æˆ·æ´»åŠ¨

```typescript
// æ–°å¢è¡¨ç»“æ„
admins: defineTable({
  userId: v.string(),
  role: v.union(v.literal("super_admin"), v.literal("admin"), v.literal("support")),
  permissions: v.array(v.string()),
  createdAt: v.number(),
  createdBy: v.optional(v.string())
})

products: defineTable({
  name: v.string(),
  description: v.string(),
  polarProductId: v.string(),
  isActive: v.boolean(),
  category: v.optional(v.string()),
  features: v.array(v.string()),
  metadata: v.optional(v.any())
})

audit_logs: defineTable({
  adminId: v.string(),
  action: v.string(),
  target: v.string(),
  targetId: v.string(),
  details: v.optional(v.any()),
  timestamp: v.number()
})
```

### 1.2 æƒé™ç®¡ç†ç³»ç»Ÿ
**æ–°å»ºæ–‡ä»¶**: `convex/permissions.ts`
- [ ] å®ç°æƒé™æ£€æŸ¥å‡½æ•°
- [ ] åˆ›å»ºè§’è‰²æƒé™æ˜ å°„
- [ ] æ·»åŠ ç®¡ç†å‘˜éªŒè¯ä¸­é—´ä»¶

### 1.3 ç®¡ç†å‘˜è®¤è¯å‡½æ•°
**æ–°å»ºæ–‡ä»¶**: `convex/admin.ts`
- [ ] `checkAdminPermission` - æ£€æŸ¥ç®¡ç†å‘˜æƒé™
- [ ] `promoteUserToAdmin` - æå‡ç”¨æˆ·ä¸ºç®¡ç†å‘˜
- [ ] `revokeAdminAccess` - æ’¤é”€ç®¡ç†å‘˜æƒé™
- [ ] `getAdminProfile` - è·å–ç®¡ç†å‘˜ä¿¡æ¯

## é˜¶æ®µäºŒï¼šç®¡ç†å‘˜è·¯ç”±å’Œå¸ƒå±€ ğŸš€

### 2.1 ç®¡ç†å‘˜è·¯ç”±é…ç½®
**æ–‡ä»¶ä¿®æ”¹**: `app/routes.ts`
- [ ] æ·»åŠ adminè·¯ç”±ç»„
- [ ] é…ç½®å—ä¿æŠ¤çš„ç®¡ç†å‘˜è·¯ç”±

```typescript
layout("routes/admin/layout.tsx", [
  route("admin", "routes/admin/index.tsx"),
  route("admin/users", "routes/admin/users.tsx"),
  route("admin/subscriptions", "routes/admin/subscriptions.tsx"),
  route("admin/products", "routes/admin/products.tsx"),
  route("admin/analytics", "routes/admin/analytics.tsx"),
  route("admin/settings", "routes/admin/settings.tsx"),
])
```

### 2.2 ç®¡ç†å‘˜å¸ƒå±€ç»„ä»¶
**æ–°å»ºæ–‡ä»¶**: `app/routes/admin/layout.tsx`
- [ ] åˆ›å»ºç®¡ç†å‘˜ä¸“ç”¨å¸ƒå±€
- [ ] æ·»åŠ ç®¡ç†å‘˜æƒé™éªŒè¯loader
- [ ] é›†æˆç®¡ç†å‘˜ä¾§è¾¹æ å¯¼èˆª

**æ–°å»ºæ–‡ä»¶**: `app/components/admin/admin-sidebar.tsx`
- [ ] ç®¡ç†å‘˜å¯¼èˆªèœå•
- [ ] æƒé™åŸºç¡€çš„èœå•æ˜¾ç¤º
- [ ] æ“ä½œç»Ÿè®¡å¿«æ·å…¥å£

## é˜¶æ®µä¸‰ï¼šç”¨æˆ·ç®¡ç†ç³»ç»Ÿ ğŸ‘¥

### 3.1 ç”¨æˆ·ç®¡ç†é¡µé¢
**æ–°å»ºæ–‡ä»¶**: `app/routes/admin/users.tsx`
- [ ] ç”¨æˆ·åˆ—è¡¨å±•ç¤ºï¼ˆåˆ†é¡µã€æœç´¢ã€ç­›é€‰ï¼‰
- [ ] ç”¨æˆ·è¯¦æƒ…æŸ¥çœ‹
- [ ] ç”¨æˆ·çŠ¶æ€ç®¡ç†ï¼ˆæ¿€æ´»/ç¦ç”¨ï¼‰
- [ ] æ‰¹é‡æ“ä½œåŠŸèƒ½

### 3.2 ç”¨æˆ·ç®¡ç†ç»„ä»¶
**æ–°å»ºç›®å½•**: `app/components/admin/users/`
- [ ] `UserTable.tsx` - ç”¨æˆ·æ•°æ®è¡¨æ ¼
- [ ] `UserDetail.tsx` - ç”¨æˆ·è¯¦æƒ…å¼¹çª—
- [ ] `UserActions.tsx` - ç”¨æˆ·æ“ä½œæŒ‰é’®ç»„
- [ ] `UserFilters.tsx` - ç”¨æˆ·ç­›é€‰å™¨
- [ ] `UserStats.tsx` - ç”¨æˆ·ç»Ÿè®¡å¡ç‰‡

### 3.3 ç”¨æˆ·ç®¡ç†åç«¯å‡½æ•°
**æ–‡ä»¶ä¿®æ”¹**: `convex/users.ts`
- [ ] `getAllUsers` - è·å–æ‰€æœ‰ç”¨æˆ·ï¼ˆåˆ†é¡µï¼‰
- [ ] `getUserDetail` - è·å–ç”¨æˆ·è¯¦æƒ…
- [ ] `updateUserStatus` - æ›´æ–°ç”¨æˆ·çŠ¶æ€
- [ ] `deleteUser` - åˆ é™¤ç”¨æˆ·
- [ ] `searchUsers` - æœç´¢ç”¨æˆ·
- [ ] `getUserActivity` - è·å–ç”¨æˆ·æ´»åŠ¨è®°å½•

## é˜¶æ®µå››ï¼šè®¢é˜…ç®¡ç†ç³»ç»Ÿ ğŸ’³

### 4.1 è®¢é˜…ç®¡ç†é¡µé¢
**æ–°å»ºæ–‡ä»¶**: `app/routes/admin/subscriptions.tsx`
- [ ] è®¢é˜…åˆ—è¡¨å±•ç¤º
- [ ] è®¢é˜…çŠ¶æ€ç›‘æ§
- [ ] æ”¶å…¥ç»Ÿè®¡åˆ†æ
- [ ] è®¢é˜…æ“ä½œç®¡ç†

### 4.2 è®¢é˜…ç®¡ç†ç»„ä»¶
**æ–°å»ºç›®å½•**: `app/components/admin/subscriptions/`
- [ ] `SubscriptionTable.tsx` - è®¢é˜…æ•°æ®è¡¨æ ¼
- [ ] `SubscriptionDetail.tsx` - è®¢é˜…è¯¦æƒ…
- [ ] `RevenueChart.tsx` - æ”¶å…¥å›¾è¡¨
- [ ] `SubscriptionFilters.tsx` - è®¢é˜…ç­›é€‰
- [ ] `SubscriptionActions.tsx` - è®¢é˜…æ“ä½œ

### 4.3 è®¢é˜…ç®¡ç†åç«¯å‡½æ•°
**æ–‡ä»¶ä¿®æ”¹**: `convex/subscriptions.ts`
- [ ] `getAllSubscriptions` - è·å–æ‰€æœ‰è®¢é˜…
- [ ] `getSubscriptionAnalytics` - è·å–è®¢é˜…åˆ†ææ•°æ®
- [ ] `cancelSubscription` - å–æ¶ˆè®¢é˜…
- [ ] `refundSubscription` - é€€æ¬¾å¤„ç†
- [ ] `getRevenueData` - è·å–æ”¶å…¥æ•°æ®
- [ ] `getChurnAnalysis` - è·å–æµå¤±åˆ†æ

## é˜¶æ®µäº”ï¼šäº§å“é…ç½®ç³»ç»Ÿ ğŸ›ï¸

### 5.1 äº§å“ç®¡ç†é¡µé¢
**æ–°å»ºæ–‡ä»¶**: `app/routes/admin/products.tsx`
- [ ] äº§å“åˆ—è¡¨ç®¡ç†
- [ ] åˆ›å»º/ç¼–è¾‘äº§å“
- [ ] ä»·æ ¼ç®¡ç†
- [ ] äº§å“çŠ¶æ€æ§åˆ¶

### 5.2 äº§å“ç®¡ç†ç»„ä»¶
**æ–°å»ºç›®å½•**: `app/components/admin/products/`
- [ ] `ProductTable.tsx` - äº§å“åˆ—è¡¨è¡¨æ ¼
- [ ] `ProductForm.tsx` - äº§å“ç¼–è¾‘è¡¨å•
- [ ] `PriceManager.tsx` - ä»·æ ¼ç®¡ç†å™¨
- [ ] `ProductPreview.tsx` - äº§å“é¢„è§ˆ
- [ ] `FeatureEditor.tsx` - åŠŸèƒ½ç‰¹æ€§ç¼–è¾‘å™¨

### 5.3 äº§å“ç®¡ç†åç«¯å‡½æ•°
**æ–°å»ºæ–‡ä»¶**: `convex/products.ts`
- [ ] `getAllProducts` - è·å–æ‰€æœ‰äº§å“
- [ ] `createProduct` - åˆ›å»ºäº§å“
- [ ] `updateProduct` - æ›´æ–°äº§å“
- [ ] `deleteProduct` - åˆ é™¤äº§å“
- [ ] `syncWithPolar` - ä¸Polar.shåŒæ­¥äº§å“
- [ ] `getProductAnalytics` - äº§å“åˆ†ææ•°æ®

## é˜¶æ®µå…­ï¼šæ•°æ®åˆ†æå’ŒæŠ¥å‘Šç³»ç»Ÿ ğŸ“Š

### 6.1 åˆ†æä»ªè¡¨æ¿
**æ–°å»ºæ–‡ä»¶**: `app/routes/admin/analytics.tsx`
- [ ] å…³é”®æŒ‡æ ‡å±•ç¤º
- [ ] ç”¨æˆ·å¢é•¿å›¾è¡¨
- [ ] æ”¶å…¥åˆ†æå›¾è¡¨
- [ ] äº§å“æ€§èƒ½åˆ†æ

### 6.2 åˆ†æç»„ä»¶
**æ–°å»ºç›®å½•**: `app/components/admin/analytics/`
- [ ] `MetricsGrid.tsx` - æŒ‡æ ‡ç½‘æ ¼
- [ ] `GrowthChart.tsx` - å¢é•¿å›¾è¡¨
- [ ] `RevenueBreakdown.tsx` - æ”¶å…¥åˆ†è§£
- [ ] `UserSegmentation.tsx` - ç”¨æˆ·åˆ†æ®µ
- [ ] `ConversionFunnel.tsx` - è½¬åŒ–æ¼æ–—

### 6.3 åˆ†æåç«¯å‡½æ•°
**æ–°å»ºæ–‡ä»¶**: `convex/analytics.ts`
- [ ] `getKPIMetrics` - è·å–å…³é”®æŒ‡æ ‡
- [ ] `getUserGrowthData` - ç”¨æˆ·å¢é•¿æ•°æ®
- [ ] `getRevenueAnalytics` - æ”¶å…¥åˆ†æ
- [ ] `getConversionMetrics` - è½¬åŒ–æŒ‡æ ‡
- [ ] `getRetentionAnalysis` - ç•™å­˜åˆ†æ

## é˜¶æ®µä¸ƒï¼šç³»ç»Ÿè®¾ç½®å’Œé…ç½® âš™ï¸

### 7.1 ç³»ç»Ÿè®¾ç½®é¡µé¢
**æ–°å»ºæ–‡ä»¶**: `app/routes/admin/settings.tsx`
- [ ] å…¨å±€ç³»ç»Ÿè®¾ç½®
- [ ] ç®¡ç†å‘˜è´¦æˆ·ç®¡ç†
- [ ] ç³»ç»Ÿæ—¥å¿—æŸ¥çœ‹
- [ ] å¤‡ä»½å’Œæ¢å¤

### 7.2 è®¾ç½®ç»„ä»¶
**æ–°å»ºç›®å½•**: `app/components/admin/settings/`
- [ ] `GeneralSettings.tsx` - é€šç”¨è®¾ç½®
- [ ] `AdminManagement.tsx` - ç®¡ç†å‘˜ç®¡ç†
- [ ] `SystemLogs.tsx` - ç³»ç»Ÿæ—¥å¿—
- [ ] `BackupRestore.tsx` - å¤‡ä»½æ¢å¤

### 7.3 è®¾ç½®åç«¯å‡½æ•°
**æ–‡ä»¶ä¿®æ”¹**: `convex/admin.ts`
- [ ] `updateSystemSettings` - æ›´æ–°ç³»ç»Ÿè®¾ç½®
- [ ] `getSystemLogs` - è·å–ç³»ç»Ÿæ—¥å¿—
- [ ] `createBackup` - åˆ›å»ºå¤‡ä»½
- [ ] `restoreFromBackup` - ä»å¤‡ä»½æ¢å¤

## é˜¶æ®µå…«ï¼šå®‰å…¨æ€§å’Œä¼˜åŒ– ğŸ”’

### 8.1 å®‰å…¨æ€§å¢å¼º
- [ ] å®ç°ç»†ç²’åº¦æƒé™æ§åˆ¶
- [ ] æ·»åŠ æ“ä½œå®¡è®¡æ—¥å¿—
- [ ] å®ç°IPç™½åå•åŠŸèƒ½
- [ ] æ·»åŠ ä¸¤æ­¥éªŒè¯æ”¯æŒ

### 8.2 æ€§èƒ½ä¼˜åŒ–
- [ ] å®ç°æ•°æ®åˆ†é¡µå’Œè™šæ‹ŸåŒ–
- [ ] æ·»åŠ ç¼“å­˜ç­–ç•¥
- [ ] ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
- [ ] å®ç°æ‡’åŠ è½½

### 8.3 é”™è¯¯å¤„ç†å’Œç›‘æ§
- [ ] ç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶
- [ ] æ·»åŠ é”™è¯¯è¾¹ç•Œç»„ä»¶
- [ ] å®ç°æ“ä½œç¡®è®¤å¯¹è¯æ¡†
- [ ] æ·»åŠ ç”¨æˆ·æ“ä½œåé¦ˆ

## é˜¶æ®µä¹ï¼šæµ‹è¯•å’Œéƒ¨ç½² ğŸ§ª

### 9.1 å•å…ƒæµ‹è¯•
- [ ] åç«¯å‡½æ•°æµ‹è¯•
- [ ] ç»„ä»¶å•å…ƒæµ‹è¯•
- [ ] æƒé™ç³»ç»Ÿæµ‹è¯•
- [ ] APIç«¯ç‚¹æµ‹è¯•

### 9.2 é›†æˆæµ‹è¯•
- [ ] ç”¨æˆ·æµç¨‹æµ‹è¯•
- [ ] ç®¡ç†å‘˜å·¥ä½œæµæµ‹è¯•
- [ ] æ”¯ä»˜æµç¨‹æµ‹è¯•
- [ ] æ•°æ®ä¸€è‡´æ€§æµ‹è¯•

### 9.3 éƒ¨ç½²é…ç½®
- [ ] ç¯å¢ƒå˜é‡é…ç½®
- [ ] æ•°æ®åº“è¿ç§»è„šæœ¬
- [ ] éƒ¨ç½²æ–‡æ¡£æ›´æ–°
- [ ] ç›‘æ§å’Œæ—¥å¿—é…ç½®

## é¢„ä¼°æ—¶é—´çº¿

- **é˜¶æ®µä¸€**: 2-3å¤© (æ•°æ®æ¨¡å‹å’Œæƒé™)
- **é˜¶æ®µäºŒ**: 1-2å¤© (è·¯ç”±å’Œå¸ƒå±€)
- **é˜¶æ®µä¸‰**: 3-4å¤© (ç”¨æˆ·ç®¡ç†)
- **é˜¶æ®µå››**: 3-4å¤© (è®¢é˜…ç®¡ç†)
- **é˜¶æ®µäº”**: 2-3å¤© (äº§å“é…ç½®)
- **é˜¶æ®µå…­**: 3-4å¤© (æ•°æ®åˆ†æ)
- **é˜¶æ®µä¸ƒ**: 2-3å¤© (ç³»ç»Ÿè®¾ç½®)
- **é˜¶æ®µå…«**: 2-3å¤© (å®‰å…¨å’Œä¼˜åŒ–)
- **é˜¶æ®µä¹**: 2-3å¤© (æµ‹è¯•å’Œéƒ¨ç½²)

**æ€»è®¡**: 20-29å¤©

## æŠ€æœ¯æ³¨æ„äº‹é¡¹

1. **æƒé™æ§åˆ¶**: æ‰€æœ‰ç®¡ç†å‘˜åŠŸèƒ½éƒ½éœ€è¦ä¸¥æ ¼çš„æƒé™éªŒè¯
2. **æ•°æ®å®‰å…¨**: æ•æ„Ÿæ“ä½œéœ€è¦äºŒæ¬¡ç¡®è®¤
3. **æ€§èƒ½è€ƒè™‘**: å¤§æ•°æ®é‡æ—¶çš„åˆ†é¡µå’Œä¼˜åŒ–
4. **ç”¨æˆ·ä½“éªŒ**: å“åº”å¼è®¾è®¡å’ŒåŠ è½½çŠ¶æ€ç®¡ç†
5. **é”™è¯¯å¤„ç†**: å‹å¥½çš„é”™è¯¯æç¤ºå’Œå›æ»šæœºåˆ¶

## ä¾èµ–è¦æ±‚

ç°æœ‰ä¾èµ–å·²æ»¡è¶³å¤§éƒ¨åˆ†éœ€æ±‚ï¼Œå¯èƒ½éœ€è¦é¢å¤–æ·»åŠ ï¼š
- æ•°æ®å¯è§†åŒ–åº“ï¼ˆå¦‚rechartsï¼Œå·²åŒ…å«ï¼‰
- è¡¨æ ¼ç»„ä»¶ï¼ˆ@tanstack/react-tableï¼Œå·²åŒ…å«ï¼‰
- æ—¥æœŸå¤„ç†åº“ï¼ˆå¦‚date-fnsï¼‰
- å¯¼å‡ºåŠŸèƒ½åº“ï¼ˆå¦‚xlsxï¼‰